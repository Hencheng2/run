<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CodeRunner - Multi-Language Code Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #1e1e1e; color: #fff; }
        .code-editor { width: 100%; height: 100%; background-color: #1e1e1e; color: #fff; border: none; padding: 16px; font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; font-size: 14px; line-height: 1.5; resize: none; tab-size: 4; -moz-tab-size: 4; white-space: pre; overflow: auto; min-height:200px; }
        .btn-hover:hover { background-color: rgba(0,122,204,0.8); }
        .output-panel { font-family: monospace; white-space: pre-wrap; }
        .loading-spinner { border: 3px solid #f3f3f3; border-top: 3px solid #007acc; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; margin-right: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .html-output { width: 100%; height: 100%; border: none; background: white; color: black; }
        .file-item { transition: background-color 0.2s; display:flex; justify-content:space-between; align-items:center; }
        .file-item:hover { background-color: #2d2d30; }
        .delete-btn { opacity:0; transition: opacity 0.2s; color:#f87171; cursor:pointer; padding:2px 6px; border-radius:4px; }
        .file-item:hover .delete-btn { opacity:1; }
        /* responsive tweaks */
        main { min-height: calc(100vh - 112px); }
    </style>
</head>
<body class="flex flex-col h-screen">
    <header class="bg-gray-800 p-4 flex items-center justify-between">
        <div class="flex items-center space-x-4">
            <h1 class="text-xl font-bold">CodeRunner</h1>
            <div>
                <select id="language-select" class="bg-gray-700 text-white p-2 rounded">
                    <option value="python">Python</option>
                    <option value="javascript">JavaScript</option>
                    <option value="html">HTML</option>
                    <option value="css">CSS</option>
                    <option value="cpp">C++</option>
                    <option value="java">Java</option>
                    <option value="php">PHP</option>
                    <option value="ruby">Ruby</option>
                    <option value="go">Go</option>
                    <option value="rust">Rust</option>
                    <option value="sql">SQL</option>
                    <option value="swift">Swift</option>
                    <option value="typescript">TypeScript</option>
                </select>
            </div>
            <input type="text" id="project-name" placeholder="Project Name" class="bg-gray-700 text-white p-2 rounded w-40" value="Untitled Project" />
        </div>
        <div class="flex space-x-2">
            <button id="run-btn" class="bg-blue-600 text-white px-4 py-2 rounded btn-hover flex items-center">
                <span id="run-text">Run</span>
                <span id="run-spinner" class="loading-spinner hidden"></span>
            </button>
            <button id="save-btn" class="bg-gray-700 text-white px-4 py-2 rounded btn-hover">Save</button>
            <button id="download-btn" class="bg-gray-700 text-white px-4 py-2 rounded btn-hover">Download</button>
            <input type="file" id="upload-file" class="hidden" accept=".py,.js,.html,.txt,.json,.css,.cpp,.java,.php,.rb,.go,.rs,.sql,.swift,.ts" />
            <label for="upload-file" class="bg-gray-700 text-white px-4 py-2 rounded btn-hover cursor-pointer">Upload File</label>
        </div>
    </header>

    <main class="flex flex-1 overflow-hidden flex-col md:flex-row">
        <div id="left-pane" class="bg-gray-900 md:w-64 p-4 overflow-auto">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-semibold">Files</h2>
                <button id="new-file-btn" class="text-blue-400 hover:text-blue-300 text-sm">+ New</button>
            </div>
            <div id="file-tree" class="mb-4"></div>
            <div>
                <h3 class="font-semibold mb-2">Dependency Files</h3>
                <div id="dependency-files"></div>
            </div>
        </div>

        <div class="flex-1 flex flex-col min-w-0">
            <div class="bg-gray-800 p-2 text-sm flex justify-between">
                <span id="current-file">main.py</span>
                <div class="space-x-2">
                    <button id="toggle-filetree" class="bg-gray-700 text-white px-2 py-1 rounded md:hidden">Toggle Files</button>
                </div>
            </div>
            <textarea id="editor" class="code-editor" spellcheck="false"># Write your Python code here
print("Hello, World!")</textarea>
        </div>

        <div id="right-pane" class="bg-gray-900 md:w-1/3 p-4 overflow-auto output-panel">
            <h2 class="font-semibold mb-4">Output</h2>
            <div id="output-tabs" class="flex border-b border-gray-700 mb-2">
                <button class="tab-btn px-4 py-2 border-b-2 border-blue-500 text-blue-300" data-tab="output">Console</button>
                <button class="tab-btn px-4 py-2 text-gray-400" data-tab="html-output">HTML Output</button>
            </div>
            <div id="output-content" class="whitespace-pre-wrap flex-1 overflow-auto"></div>
            <div id="html-output-content" class="hidden flex-1 overflow-auto">
                <iframe id="html-output-frame" class="html-output"></iframe>
            </div>
        </div>
    </main>

    <footer class="bg-gray-800 p-2 flex justify-between items-center text-sm">
        <div id="status">Idle</div>
        <div>CodeRunner v1.0</div>
    </footer>

    <!-- External runtimes and helpers -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.28.2/full/pyodide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sql.js@1.6.1/dist/sql-wasm.js"></script>
    <script src="https://unpkg.com/opal-runtime@1.5.0/opal-runtime.min.js"></script>
    <script type="module">
        // php-wasm is ESM, import when needed
        let PhpWebModule = null;
        async function importPhpWasm() {
            if (PhpWebModule) return PhpWebModule;
            try {
                PhpWebModule = await import('https://cdn.jsdelivr.net/npm/php-wasm/php-web.mjs');
                return PhpWebModule;
            } catch (e) {
                console.warn('php-wasm import failed', e);
                throw e;
            }
        }
    </script>
    <script src="https://unpkg.com/typescript@5.3.3/lib/typescript.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', async function() {
        // State
        const PISTON_BASE = 'https://emkc.org/api/v2/piston'; // public piston instance

        const state = {
            currentLanguage: 'python',
            currentFile: 'main.py',
            files: {
                'main.py': { name:'main.py', content:'# Write your Python code here\nprint("Hello, World!")', language:'python' },
                'requirements.txt': { name:'requirements.txt', content:'# Add dependencies', language:'text' }
            },
            projectName: 'Untitled Project'
        };

        // Elements
        const languageSelect = document.getElementById('language-select');
        const projectNameInput = document.getElementById('project-name');
        const editor = document.getElementById('editor');
        const runButton = document.getElementById('run-btn');
        const runText = document.getElementById('run-text');
        const runSpinner = document.getElementById('run-spinner');
        const saveButton = document.getElementById('save-btn');
        const downloadButton = document.getElementById('download-btn');
        const uploadFileButton = document.getElementById('upload-file');
        const fileTree = document.getElementById('file-tree');
        const dependencyFiles = document.getElementById('dependency-files');
        const outputContent = document.getElementById('output-content');
        const htmlOutputFrame = document.getElementById('html-output-frame');
        const htmlOutputContent = document.getElementById('html-output-content');
        const statusElement = document.getElementById('status');
        const currentFileElement = document.getElementById('current-file');
        const tabButtons = document.querySelectorAll('.tab-btn');
        const newFileBtn = document.getElementById('new-file-btn');
        const toggleFiletree = document.getElementById('toggle-filetree');
        const leftPane = document.getElementById('left-pane');

        // Initialize
        updateFileTree(); updateDependencyFiles();

        // Load pyodide and sql.js eagerly so Python + SQL run instantly
        let pyodide = null;
        let SQL = null;
        (async function loadRuntimes(){
            try {
                statusElement.textContent = 'Loading runtimes...';
                // Pyodide
                pyodide = await loadPyodide({indexURL:'https://cdn.jsdelivr.net/pyodide/v0.28.2/full/'});
                // sql.js init
                SQL = await initSqlJs({ locateFile: filename => `https://cdn.jsdelivr.net/npm/sql.js@1.6.1/dist/${filename}` });
                statusElement.textContent = 'Idle';
            } catch (e) {
                console.error('Runtime load failed', e);
                statusElement.textContent = 'Runtime load failed';
            }
        })();

        // Events
        languageSelect.addEventListener('change', handleLanguageChange);
        projectNameInput.addEventListener('change', handleProjectNameChange);
        editor.addEventListener('input', handleEditorChange);
        runButton.addEventListener('click', runCode);
        saveButton.addEventListener('click', saveProject);
        downloadButton.addEventListener('click', downloadProject);
        uploadFileButton.addEventListener('change', handleFileUpload);
        newFileBtn.addEventListener('click', addNewFile);
        toggleFiletree.addEventListener('click', () => { leftPane.classList.toggle('hidden'); });

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tab = button.dataset.tab;
                tabButtons.forEach(btn=>{ btn.classList.remove('border-b-2','border-blue-500','text-blue-300'); btn.classList.add('text-gray-400'); });
                button.classList.add('border-b-2','border-blue-500','text-blue-300'); button.classList.remove('text-gray-400');
                if (tab==='output'){ outputContent.classList.remove('hidden'); htmlOutputContent.classList.add('hidden'); }
                else { outputContent.classList.add('hidden'); htmlOutputContent.classList.remove('hidden'); }
            });
        });

        // Handlers & helpers (kept similar to your original, with execution implementations)
        function handleLanguageChange(){
            state.currentLanguage = languageSelect.value;
            const extension = getExtensionForLanguage(state.currentLanguage);
            const newFileName = `main.${extension}`;
            if (!state.files[newFileName]){
                state.files[newFileName] = { name:newFileName, content:getDefaultCode(state.currentLanguage), language:state.currentLanguage };
                updateFileTree();
            }
            switchFile(newFileName);
        }
        function handleProjectNameChange(){ state.projectName = projectNameInput.value || 'Untitled Project'; }
        function handleEditorChange(){ state.files[state.currentFile].content = editor.value; }
        function switchFile(fileName){ if (!state.files[fileName]) return; state.currentFile=fileName; const file=state.files[fileName]; editor.value=file.content; currentFileElement.textContent=fileName; if (file.language!==state.currentLanguage && file.language!=='text'){ state.currentLanguage=file.language; languageSelect.value=file.language; } document.querySelectorAll('.file-item').forEach(item=>item.classList.remove('bg-gray-700')); const el=document.querySelector(`.file-item[data-file='${fileName}']`); if(el) el.classList.add('bg-gray-700'); }
        function addNewFile(){ const fileName = prompt('Enter file name:'); if(!fileName) return; const language = getLanguageFromExtension(fileName); state.files[fileName]={name:fileName, content:getDefaultCode(language), language:language}; if(isDependencyFile(fileName)) updateDependencyFiles(); else updateFileTree(); switchFile(fileName); }
        function deleteFile(fileName){ if(!confirm(`Delete ${fileName}?`)) return; if(fileName===state.currentFile){ const others=Object.keys(state.files).filter(n=>n!==fileName); if(others.length) switchFile(others[0]); else { const ext=getExtensionForLanguage(state.currentLanguage); const newFileName=`main.${ext}`; state.files[newFileName]={name:newFileName, content:getDefaultCode(state.currentLanguage), language:state.currentLanguage}; switchFile(newFileName); } } delete state.files[fileName]; if(isDependencyFile(fileName)) updateDependencyFiles(); else updateFileTree(); }

        function updateFileTree(){ fileTree.innerHTML=''; Object.keys(state.files).forEach(fileName=>{ if(!isDependencyFile(fileName)){ const fileElement=document.createElement('div'); fileElement.className='file-item p-2 rounded cursor-pointer'; fileElement.dataset.file=fileName; fileElement.innerHTML=`<span>${fileName}</span><span class="delete-btn" data-file="${fileName}">×</span>`; if(fileName===state.currentFile) fileElement.classList.add('bg-gray-700'); fileElement.addEventListener('click',(e)=>{ if(!e.target.classList.contains('delete-btn')) switchFile(fileName); }); const deleteBtn=fileElement.querySelector('.delete-btn'); deleteBtn.addEventListener('click',(e)=>{ e.stopPropagation(); deleteFile(fileName); }); fileTree.appendChild(fileElement); } }); }
        function updateDependencyFiles(){ dependencyFiles.innerHTML=''; Object.keys(state.files).forEach(fileName=>{ if(isDependencyFile(fileName)){ const fileElement=document.createElement('div'); fileElement.className='file-item p-2 rounded cursor-pointer'; fileElement.dataset.file=fileName; fileElement.innerHTML=`<span>${fileName}</span><span class="delete-btn" data-file="${fileName}">×</span>`; if(fileName===state.currentFile) fileElement.classList.add('bg-gray-700'); fileElement.addEventListener('click',(e)=>{ if(!e.target.classList.contains('delete-btn')) switchFile(fileName); }); const deleteBtn=fileElement.querySelector('.delete-btn'); deleteBtn.addEventListener('click',(e)=>{ e.stopPropagation(); deleteFile(fileName); }); dependencyFiles.appendChild(fileElement); } }); }
        function handleFileUpload(event){ const files = event.target.files; for(let i=0;i<files.length;i++){ const file=files[i]; const reader=new FileReader(); reader.onload=function(e){ const content=e.target.result; state.files[file.name]={ name:file.name, content:content, language:getLanguageFromExtension(file.name) }; if(isDependencyFile(file.name)) updateDependencyFiles(); else updateFileTree(); }; reader.readAsText(file); } event.target.value=''; }

        async function runCode(){ statusElement.textContent='Running...'; runSpinner.classList.remove('hidden'); runText.textContent='Running'; outputContent.textContent=''; htmlOutputFrame.srcdoc=''; try{ const code = editor.value; const language = state.currentLanguage; switch(language){ case 'python': await runPythonCode(code); break; case 'javascript': runJavaScriptCode(code); break; case 'html': runHTMLCode(code); break; case 'css': runCSSCode(code); break; case 'typescript': runTypeScriptCode(code); break; case 'sql': runSQLCode(code); break; case 'ruby': runRubyCode(code); break; case 'php': await runPHPCode(code); break; default: // fall back to remote executor for compiled / server languages
                    await runRemoteViaPiston(language, code);
                }
                statusElement.textContent = 'Execution completed';
            } catch (error){ outputContent.textContent = `Error: ${error.message}`; statusElement.textContent='Error'; }
            finally{ runSpinner.classList.add('hidden'); runText.textContent='Run'; // show console tab
                document.querySelectorAll('.tab-btn').forEach(btn=>{ btn.classList.remove('border-b-2','border-blue-500','text-blue-300'); btn.classList.add('text-gray-400'); });
                document.querySelector('[data-tab="output"]').classList.add('border-b-2','border-blue-500','text-blue-300'); outputContent.classList.remove('hidden'); htmlOutputContent.classList.add('hidden'); }
        }

        // Implementations
        async function runPythonCode(code){ try{ if(!pyodide) { outputContent.textContent='Pyodide not loaded yet.'; return; }
                await pyodide.loadPackagesFromImports(code).catch(()=>{});
                const results = await pyodide.runPythonAsync(`__result = (lambda: (\n${code}\n))()`);
                // Many python scripts print to stdout — capture prints by redirecting sys.stdout
                // Simpler: run a wrapper that captures stdout
                const capture = `import sys, io
buf=io.StringIO()
_old_stdout=sys.stdout
sys.stdout=buf
try:
${code.split('\n').map(l=>'    '+l).join('\n')}
finally:
    sys.stdout=_old_stdout
print(buf.getvalue(), end='')`;
                try{ const out = await pyodide.runPythonAsync(capture); outputContent.textContent = out===undefined ? 'Python finished (no output)' : String(out); }catch(e){ outputContent.textContent = 'Python error: '+e; }
            }catch(e){ outputContent.textContent = 'Python error: '+e; }
        }

        function runJavaScriptCode(code){ try{ const originalConsoleLog = console.log; const logs = []; console.log = function(){ logs.push(Array.from(arguments).join(' ')); originalConsoleLog.apply(console, arguments); }
                // run in Function scope to avoid leaking local variables
                (new Function(code))();
                console.log = originalConsoleLog;
                outputContent.textContent = logs.length?logs.join('\n'):'JavaScript executed (no output)';
            }catch(e){ outputContent.textContent = 'JavaScript error: '+e.message; }
        }

        function runHTMLCode(code){ try{ htmlOutputFrame.srcdoc = code; // switch to HTML tab
                document.querySelectorAll('.tab-btn').forEach(btn=>{ btn.classList.remove('border-b-2','border-blue-500','text-blue-300'); btn.classList.add('text-gray-400'); }); document.querySelector('[data-tab="html-output"]').classList.add('border-b-2','border-blue-500','text-blue-300'); outputContent.classList.add('hidden'); htmlOutputContent.classList.remove('hidden'); outputContent.textContent='HTML rendered in iframe'; }catch(e){ outputContent.textContent='HTML error: '+e.message; } }

        function runCSSCode(code){ try{ const htmlWithCSS = `<style>${code}</style><div class="css-output"><h1>CSS Output Preview</h1><p>This is a preview of your CSS styles.</p><button class="btn">Styled Button</button></div>`; htmlOutputFrame.srcdoc = htmlWithCSS; document.querySelectorAll('.tab-btn').forEach(btn=>{ btn.classList.remove('border-b-2','border-blue-500','text-blue-300'); btn.classList.add('text-gray-400'); }); document.querySelector('[data-tab="html-output"]').classList.add('border-b-2','border-blue-500','text-blue-300'); outputContent.classList.add('hidden'); htmlOutputContent.classList.remove('hidden'); outputContent.textContent='CSS rendered in iframe'; }catch(e){ outputContent.textContent='CSS error: '+e.message; } }

        function runTypeScriptCode(code){ try{ // transpile using the loaded TypeScript lib
                if(window.ts && ts.transpileModule){ const transpiled = ts.transpileModule(code, {compilerOptions:{module:ts.ModuleKind.ES2015, target: ts.ScriptTarget.ES2017}}).outputText; // execute transpiled JS
                        runJavaScriptCode(transpiled);
                } else {
                    outputContent.textContent = 'TypeScript compiler not loaded';
                }
            }catch(e){ outputContent.textContent='TypeScript error: '+e.message; }
        }

        function runSQLCode(code){ try{ if(!SQL) { outputContent.textContent='SQL runtime not ready'; return; }
                const db = new SQL.Database();
                let res = '\n';
                try{
                    const r = db.exec(code);
                    if(r.length===0) res = 'Query executed (no result)';
                    else { res = r.map(table=>{ const cols=table.columns.join('\t'); const rows = table.values.map(v=>v.join('\t')).join('\n'); return cols+'\n'+rows }).join('\n\n'); }
                }catch(e){ res = 'SQL error: '+e.message; }
                outputContent.textContent = res;
            }catch(e){ outputContent.textContent='SQL error: '+e.message; }
        }

        function runRubyCode(code){ try{ if(!window.Opal){ outputContent.textContent='Opal (Ruby->JS) not loaded'; return; }
                try{ const js = Opal.compile(code); // evaluate compiled JS
                    (new Function(js))(); outputContent.textContent='Ruby executed (no captured output)';
                }catch(e){ outputContent.textContent='Ruby error: '+e.message; }
            }catch(e){ outputContent.textContent='Ruby error: '+e.message; }
        }

        async function runPHPCode(code){ try{ const mod = await importPhpWasm(); const PhpWeb = mod.PhpWeb || mod.Php || mod.default; if(!PhpWeb){ outputContent.textContent='php-wasm failed to load'; return; }
                const php = await PhpWeb.create(); // create instance
                const out = await php.run(code);
                outputContent.textContent = out.stdout || out.toString() || 'PHP executed (no output)';
            }catch(e){ outputContent.textContent='PHP error: '+e.message; }
        }

        async function runRemoteViaPiston(language, code){ try{ // Prepare files payload
                const ext = getExtensionForLanguage(language);
                const filename = `Main.${ext}`;
                const payload = { language: mapToPistonLanguage(language), files:[{ name: filename, content: code }], stdin:'', args:[] };
                outputContent.textContent = 'Sending code to remote executor...';
                const resp = await fetch(`${PISTON_BASE}/execute`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
                if(!resp.ok){ const text = await resp.text(); outputContent.textContent = `Remote executor error: ${resp.status} ${text}`; return; }
                const data = await resp.json(); // show compile and run
                let out = '';
                if(data.compile) out += `COMPILE:\n${data.compile.output || ''}\n`;
                if(data.run) out += `RUN:\n${data.run.output || data.run.stdout || ''}\nEXIT CODE: ${data.run.code}\n`;
                outputContent.textContent = out || 'Remote execution returned no output';
            }catch(e){ outputContent.textContent = 'Remote execution error: '+e.message; }
        }

        // Save / Download
        function saveProject(){ try{ localStorage.setItem('codeRunner_project', JSON.stringify(state)); statusElement.textContent='Project saved'; setTimeout(()=>statusElement.textContent='Idle',1500); }catch(e){ statusElement.textContent='Error saving'; } }
        function downloadProject(){ try{ const data = JSON.stringify(state,null,2); const blob = new Blob([data],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`${state.projectName}.coderunner`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); statusElement.textContent='Project downloaded'; setTimeout(()=>statusElement.textContent='Idle',1500); }catch(e){ statusElement.textContent='Error downloading'; } }

        // Helpers
        function getExtensionForLanguage(language){ switch(language){ case 'python': return 'py'; case 'javascript': return 'js'; case 'html': return 'html'; case 'css': return 'css'; case 'cpp': return 'cpp'; case 'java': return 'java'; case 'php': return 'php'; case 'ruby': return 'rb'; case 'go': return 'go'; case 'rust': return 'rs'; case 'sql': return 'sql'; case 'swift': return 'swift'; case 'typescript': return 'ts'; default: return 'txt'; }}

        function getDefaultCode(language){ switch(language){ case 'python': return '# Write your Python code here\nprint("Hello, World!")'; case 'javascript': return '// JS\nconsole.log("Hello, World!");'; case 'html': return '<!DOCTYPE html>\n<html>\n<head><title>Hello</title></head>\n<body><h1>Hello, World!</h1></body>\n</html>'; case 'css': return '/* CSS */\nbody{font-family:Arial;}\nh1{color:#06f;}'; case 'cpp': return '#include <iostream>\nint main(){ std::cout<<"Hello"<<std::endl; }'; case 'java': return 'public class Main{ public static void main(String[]args){ System.out.println("Hello"); } }'; case 'php': return '<?php echo "Hello"; ?>'; case 'ruby': return 'puts "Hello"'; case 'go': return 'package main\nimport "fmt"\nfunc main(){ fmt.Println("Hello") }'; case 'rust': return 'fn main(){ println!("Hello"); }'; case 'sql': return 'CREATE TABLE users(id INTEGER, name TEXT);\nINSERT INTO users VALUES(1, "Alice");\nSELECT * FROM users;'; case 'swift': return 'print("Hello")'; case 'typescript': return 'const msg: string = "Hello"; console.log(msg);'; default: return ''; }}

        function getLanguageFromExtension(filename){ const ext = filename.split('.').pop().toLowerCase(); switch(ext){ case 'py': return 'python'; case 'js': return 'javascript'; case 'html': return 'html'; case 'css': return 'css'; case 'cpp': case 'cc': case 'cxx': case 'hpp': return 'cpp'; case 'java': return 'java'; case 'php': return 'php'; case 'rb': return 'ruby'; case 'go': return 'go'; case 'rs': return 'rust'; case 'sql': return 'sql'; case 'swift': return 'swift'; case 'ts': return 'typescript'; case 'txt': return 'text'; case 'json': return 'text'; default: return 'text'; }}

        function isDependencyFile(fileName){ const dependencyFiles = ['requirements.txt','package.json','composer.json','gemfile','go.mod','cargo.toml','pom.xml','build.gradle']; return dependencyFiles.includes(fileName.toLowerCase()); }

        function mapToPistonLanguage(language){ // map editor language to a known Piston alias
            const map = { 'cpp':'cpp', 'java':'java', 'go':'go', 'rust':'rust', 'swift':'swift', 'php':'php', 'ruby':'ruby', 'python':'python', 'javascript':'javascript', 'typescript':'typescript', 'sql':'sql' };
            return map[language]||language;
        }

        // Load saved project
        const saved = localStorage.getItem('codeRunner_project'); if(saved){ try{ const p = JSON.parse(saved); Object.assign(state,p); projectNameInput.value=state.projectName; languageSelect.value=state.currentLanguage; if(state.files[state.currentFile]) switchFile(state.currentFile); updateFileTree(); updateDependencyFiles(); }catch(e){ console.warn('Load project failed',e); } }

    });
    </script>
</body>
</html>
